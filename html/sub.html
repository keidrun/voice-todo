<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="../vendors/css/material.deep-red.min.css">
  <link rel="stylesheet" href="../css/todo-window.css">
  <title>Add Todo</title>
</head>
<body>
  <div class="window-sub">

  <!-- <div id="speech">
    <img id="speech-image" src="../img/microphone_off.svg" width="250">
  </div> -->

    <form>
      <div class="mdl-textfield mdl-js-textfield">
        <input autofocus class="todo-text mdl-textfield__input" type="text">
        <label class="todo-text mdl-textfield__label">New Todo...</label>
      </div>
      <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">Add</button>
    </form>

  </div>

  <script defer src="../vendors/js/material.min.js"></script>
  <script>
    const electron = require('electron');
    const { ipcRenderer } = electron;

    // TODO: Fix after Google restart providing web speech api.
    // const addTodoViaSpeech = document.getElementById('speech');
    // const speechImage = document.getElementById('speech-image');
    // let speechLang = 'ja-JP';

    const addTodoForm = document.querySelector('form');

    // // Set-up Web Speech Recognition
    // let recognition;
    // if (!('webkitSpeechRecognition' in window)) {
    //   // Disable speech image
    // } else {
    //   // Disable input form
    //   addTodoForm.style.display='none';

    //   recognition = new webkitSpeechRecognition();
    //   recognition.continuous = true;
    //   recognition.interimResults = true;
    //   recognition.lang = speechLang;
    //   recognition.maxAlternatives = 1;

    //   // Listening
    //   recognition.onstart = () => {
    //     speechImage.src = '../img/microphone_on.svg';
    //   };

    //   // Done
    //   recognition.onend = () => {
    //     speechImage.src = '../img/microphone_off.svg';
    //   };

    //   // Get Result
    //   recognition.onresult = (event) => {
    //     console.log('aaaaaaaaa')
    //     if (typeof(event.results) === 'undefined') {
    //       recognition.stop();
    //       return;
    //     }

    //     for (var i = event.resultIndex; i < event.results.length; ++i) {
    //       if (event.results[i].isFinal) {
    //         console.log("final results: " + event.results[i][0].transcript);
    //       } else {
    //         console.log("interim results: " + event.results[i][0].transcript);
    //       }
    //     }
    //   };

    //   // Handle Error
    //   recognition.onerror = function(e) {
    //     recognition.stop();
    //     console.error(e);
    //   }

    // }

    // // Add new todo on speech
    // addTodoViaSpeech.addEventListener('click', (event) => {
    //   recognition.start();
    // });

    // Add new todo on form
    addTodoForm.addEventListener('submit', (event) => {
      event.preventDefault();

      const { value } = document.querySelector('input');
      ipcRenderer.send('todo:add', value);
    });

  </script>
</body>
</html>
